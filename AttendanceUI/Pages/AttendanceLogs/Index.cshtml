@page
@using AttendanceUI.Services
@model AttendanceUI.Pages.AttendanceLogs.IndexModel
@{
    ViewData["Title"] = "Attendance Logs";
}

<div class="d-flex align-items-center justify-content-between mb-4">
    <div>
        <h4 class="mb-1 fw-bold">Attendance Logs</h4>
        <p class="text-muted mb-0 small">Raw biometric punch records (local office time)</p>
    </div>
</div>

<!-- Filter Card -->
<div class="card mb-4">
    <div class="card-header">
        <h6 class="mb-0"><i class="bi bi-funnel me-2 text-primary"></i>Filter Logs</h6>
    </div>
    <div class="card-body py-3">
        <form method="get" class="row g-3 align-items-end">
            <div class="col-md-2">
                <label class="form-label small fw-semibold">From Date</label>
                <input type="date" name="StartDate" class="form-control" value="@(Model.StartDate?.ToString("yyyy-MM-dd"))" />
            </div>
            <div class="col-md-2">
                <label class="form-label small fw-semibold">To Date</label>
                <input type="date" name="EndDate" class="form-control" value="@(Model.EndDate?.ToString("yyyy-MM-dd"))" />
            </div>
            <div class="col-md-3">
                <label class="form-label small fw-semibold">Employee ID</label>
                <input type="text" name="EmployeeIdFilter" class="form-control" value="@Model.EmployeeIdFilter" placeholder="e.g. EMP001" />
            </div>
            <div class="col-md-3">
                <label class="form-label small fw-semibold">Employee Name</label>
                <input type="text" name="EmployeeNameFilter" class="form-control" value="@Model.EmployeeNameFilter" placeholder="Search name..." />
            </div>
            <div class="col-md-2 d-flex gap-2">
                <button type="submit" class="btn btn-primary flex-fill">
                    <i class="bi bi-search me-1"></i>Filter
                </button>
                @if (Model.StartDate.HasValue || Model.EndDate.HasValue || !string.IsNullOrWhiteSpace(Model.EmployeeIdFilter) || !string.IsNullOrWhiteSpace(Model.EmployeeNameFilter))
                {
                    <a asp-page="./Index" class="btn btn-outline-secondary" title="Clear">
                        <i class="bi bi-x-lg"></i>
                    </a>
                }
            </div>
        </form>
    </div>
</div>

<!-- Logs Card -->
<div class="card">
    <div class="card-header d-flex align-items-center justify-content-between">
        <h5 class="mb-0">Punch Records</h5>
        <div class="d-flex gap-2 align-items-center">
            <span class="small text-muted">Page @Model.PageNumber</span>
            <a class="btn btn-sm btn-outline-secondary @((Model.PageNumber <= 1) ? "disabled" : "")"
               asp-page="./Index" asp-route-PageNumber="@(Model.PageNumber - 1)"
               asp-route-PageSize="@Model.PageSize" asp-route-StartDate="@(Model.StartDate?.ToString("yyyy-MM-dd"))"
               asp-route-EndDate="@(Model.EndDate?.ToString("yyyy-MM-dd"))"
               asp-route-EmployeeIdFilter="@Model.EmployeeIdFilter"
               asp-route-EmployeeNameFilter="@Model.EmployeeNameFilter">
                <i class="bi bi-chevron-left"></i>
            </a>
            <a class="btn btn-sm btn-outline-secondary @((!Model.HasNextPage) ? "disabled" : "")"
               asp-page="./Index" asp-route-PageNumber="@(Model.PageNumber + 1)"
               asp-route-PageSize="@Model.PageSize" asp-route-StartDate="@(Model.StartDate?.ToString("yyyy-MM-dd"))"
               asp-route-EndDate="@(Model.EndDate?.ToString("yyyy-MM-dd"))"
               asp-route-EmployeeIdFilter="@Model.EmployeeIdFilter"
               asp-route-EmployeeNameFilter="@Model.EmployeeNameFilter">
                <i class="bi bi-chevron-right"></i>
            </a>
        </div>
    </div>
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-modern align-middle mb-0">
                <thead>
                    <tr>
                        <th class="ps-4">Employee ID</th>
                        <th>Employee Name</th>
                        <th>Punch Time</th>
                        <th>Verify Mode</th>
                        <th>Device</th>
                    </tr>
                </thead>
                <tbody>
                @if (Model.Logs.Count == 0)
                {
                    <tr><td colspan="5" class="text-center py-5 text-muted">
                        <i class="bi bi-fingerprint fs-1 d-block mb-2 opacity-25"></i>No logs found for the selected filters.
                    </td></tr>
                }
                else
                {
                    foreach (var row in Model.Logs)
                    {
                        <tr>
                            <td class="ps-4"><code class="text-primary">@row.EmployeeId</code></td>
                            <td class="fw-semibold">@(row.Employee?.EmployeeName ?? "â€”")</td>
                            <td>
                                <span class="badge text-bg-secondary">@row.PunchTime.ToString("dd-MM-yyyy")</span>
                                <span class="ms-1">@row.PunchTime.ToString("HH:mm:ss")</span>
                            </td>
                            <td class="text-muted small">@VerifyModeDecoder.Decode(row.VerifyMode)</td>
                            <td>
                                <span class="badge text-bg-secondary">
                                    <i class="bi bi-display me-1"></i>@(row.MachineNumber == 65535 ? 1 : row.MachineNumber)
                                </span>
                            </td>
                        </tr>
                    }
                }
                </tbody>
            </table>
        </div>
    </div>
</div>
