@page
@model AttendanceUI.Pages.Payroll.BulkPayslipModel
@{
    ViewData["Title"] = "Bulk Pay Slips";
}

<div class="container py-4">
    <div class="d-print-none mb-4 d-flex justify-content-between align-items-center">
        <a asp-page="/Payroll/Process" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-left me-2"></i>Back to Payroll
        </a>
        <button class="btn btn-primary px-4 shadow-sm" onclick="window.print()">
            <i class="bi bi-printer me-2"></i>Print All (@Model.Bundles.Count)
        </button>
    </div>

    <div class="bulk-payslip-wrapper">
        @foreach (var bundle in Model.Bundles)
        {
            <!-- Single Compact Payslip -->
            <div class="payslip-container bg-white mx-auto shadow-sm p-3 mb-4" style="max-width: 800px; color: #000; border: 1px solid #000; font-size: 0.82rem; page-break-inside: avoid;">
                
                <!-- Header -->
                <div class="row mb-2 border-bottom border-dark pb-2">
                    <div class="col-8">
                        <h5 class="fw-bold text-uppercase mb-0" style="letter-spacing: 0.5px;">SETU DEVELOPERS</h5>
                        <p class="text-muted extra-small mb-0 lh-1">
                            R.S. NO. 393/1, KUNTA, VAPI, VALSAD GUJARAT, 396191.
                        </p>
                    </div>
                    <div class="col-4 text-end">
                        <h6 class="fw-bold text-uppercase mb-0">Pay Slip</h6>
                        <div class="text-muted extra-small">@bundle.MonthDisplay | #@bundle.Payroll.Id.ToString("D4")</div>
                    </div>
                </div>

                <!-- Employee Info Table -->
                <div class="table-responsive mb-2">
                    <table class="table table-bordered table-xs border-dark mb-0">
                        <tbody>
                            <tr>
                                <th class="bg-light" style="width: 20%;">Employee</th>
                                <td style="width: 30%;">@bundle.Payroll.Employee?.EmployeeName</td>
                                <th class="bg-light" style="width: 20%;">Department</th>
                                <td style="width: 30%;">@bundle.Payroll.Employee?.Department?.DepartmentName</td>
                            </tr>
                            <tr>
                                <th class="bg-light">Designation</th>
                                <td>@bundle.Payroll.Employee?.Designation?.DesignationName</td>
                                <th class="bg-light">Month</th>
                                <td>@bundle.MonthDisplay</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Attendance Table -->
                <div class="table-responsive mb-2">
                    <table class="table table-bordered table-xs border-dark text-center mb-0">
                        <thead class="bg-light">
                            <tr>
                                <th style="width: 50%;">Total Days in Month</th>
                                <th style="width: 50%;" class="fw-bold">Total Payable Days</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>@bundle.Payroll.TotalDays</td>
                                <td class="fw-bold">@bundle.Payroll.PayableDays.ToString("0.#")</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Salary Breakdown Table -->
                <div class="row g-0">
                    <div class="col-6 border-start border-top border-bottom border-dark">
                        <table class="table table-xs table-borderless mb-0">
                            <thead class="border-bottom border-dark bg-light font-size-xs">
                                <tr>
                                    <th class="ps-2 py-1 text-uppercase">Earnings</th>
                                    <th class="pe-2 py-1 text-end text-uppercase">Amount</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var item in bundle.Earnings)
                                {
                                    <tr>
                                        <td class="ps-2 py-0">@item.ComponentName</td>
                                        <td class="pe-2 py-0 text-end">@item.Amount.ToString("N2")</td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                    <div class="col-6 border border-dark">
                        <table class="table table-xs table-borderless mb-0 h-100">
                            <thead class="border-bottom border-dark bg-light font-size-xs">
                                <tr>
                                    <th class="ps-2 py-1 text-uppercase">Deductions</th>
                                    <th class="pe-2 py-1 text-end text-uppercase">Amount</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var item in bundle.Deductions)
                                {
                                    <tr>
                                        <td class="ps-2 py-0">@item.ComponentName</td>
                                        <td class="pe-2 py-0 text-end">@item.Amount.ToString("N2")</td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Totals Table -->
                <div class="row g-0 border-start border-end border-bottom border-dark mb-2">
                    <div class="col-6 border-end border-dark">
                        <div class="d-flex justify-content-between px-2 py-0 fw-bold small">
                            <span>Total Earnings</span>
                            <span>₹@bundle.Payroll.TotalEarnings.ToString("N2")</span>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="d-flex justify-content-between px-2 py-0 fw-bold small">
                            <span>Total Deductions</span>
                            <span>₹@bundle.Payroll.TotalDeductions.ToString("N2")</span>
                        </div>
                    </div>
                </div>

                <!-- Net Salary Box -->
                <div class="border border-dark bg-light p-2 mb-1">
                    <div class="row align-items-center g-0">
                        <div class="col-7">
                            <div class="fw-bold text-uppercase small">Net Salary Payable: <span class="text-primary">₹@bundle.Payroll.NetSalary.ToString("N2")</span></div>
                            <div class="extra-small fw-bold mt-0 text-muted">@bundle.NetSalaryInWords</div>
                        </div>
                        <div class="col-5 text-end">
                            <div class="extra-small text-muted italic">*(Earnings - Deductions)</div>
                        </div>
                    </div>
                </div>

                <!-- Signatures -->
                <div class="row mt-4 px-4">
                    <div class="col-12 text-end">
                        <div style="height: 40px;"></div> @* Space for signing *@
                        <div class="border-top border-dark pt-0 d-inline-block" style="width: 150px;">
                            <small class="extra-small fw-bold text-uppercase">Authorised Signature</small>
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>
</div>

<style>
    body { background-color: #f4f6f9; }
    .table-xs th, .table-xs td { padding: 0.1rem 0.4rem !important; border: 1px solid #000 !important; font-size: 0.72rem; }
    .bg-light { background-color: #f8f9fa !important; }
    .extra-small { font-size: 0.62rem !important; }
    .font-size-xs { font-size: 0.68rem !important; }
    
    @@media print {
        header, footer, .sidebar, .top-bar, .d-print-none { display: none !important; }
        .container { width: 100% !important; max-width: 100% !important; margin: 0 !important; padding: 0 !important; }
        .payslip-container { border: 1px solid #000 !important; box-shadow: none !important; padding: 10px !important; margin-bottom: 25px !important; page-break-inside: avoid; }
        body { background: #fff !important; }
        .table-bordered th, .table-bordered td { border: 1px solid #000 !important; -webkit-print-color-adjust: exact; }
        .bg-light { background-color: #f8f9fa !important; -webkit-print-color-adjust: exact; }
    }
</style>
